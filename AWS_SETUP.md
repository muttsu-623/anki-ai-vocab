# AWS認証情報の取得方法（Amazon Polly用）

## 1. AWSアカウントの作成（既にお持ちの場合はスキップ）

1. [AWS公式サイト](https://aws.amazon.com/jp/)にアクセス
2. 「無料で始める」をクリック
3. メールアドレス、パスワード、アカウント名を入力
4. 個人情報とクレジットカード情報を入力（無料枠あり）
5. 電話番号認証を完了
6. サポートプランは「ベーシックサポート（無料）」を選択

## 2. IAMユーザーの作成

1. [AWS Management Console](https://console.aws.amazon.com/)にログイン
2. 検索バーで「IAM」を検索して選択
3. 左メニューから「ユーザー」→「ユーザーを追加」をクリック

### ユーザー詳細の設定
- **ユーザー名**: `anki-vocab-polly`（任意の名前）
- 「次へ」をクリック

### 権限の設定
以下のいずれかを選択：

**オプション1: AWS管理ポリシー（簡単）**
- 「ポリシーを直接アタッチする」を選択
- 検索ボックスで「Polly」を検索
- `AmazonPollyFullAccess`にチェック
- 「次へ」をクリック

**オプション2: カスタムポリシー（推奨・最小権限）**
- 「ポリシーを直接アタッチする」を選択
- 「ポリシーを作成」をクリック
- JSONタブを選択し、以下を貼り付け：

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "polly:SynthesizeSpeech",
                "polly:DescribeVoices"
            ],
            "Resource": "*"
        }
    ]
}
```

- ポリシー名: `AnkiVocabPollyPolicy`
- 作成後、ユーザーにアタッチ

## 3. アクセスキーの作成

1. 作成したユーザーをクリック
2. 「セキュリティ認証情報」タブを選択
3. 「アクセスキーを作成」をクリック
4. 「Command Line Interface (CLI)」を選択
5. 確認チェックボックスにチェックを入れて「次へ」
6. 説明タグ（オプション）: `anki-vocab-tool`
7. 「アクセスキーを作成」をクリック

### 重要：認証情報の保存
以下の情報が表示されます（**一度しか表示されません**）：
- **アクセスキーID**: `AKIA...` で始まる文字列
- **シークレットアクセスキー**: ランダムな文字列

これらを安全な場所にコピーして保存してください。

## 4. .envファイルへの設定

プロジェクトの`.env`ファイルに以下を追加：

```bash
AWS_ACCESS_KEY_ID=AKIA1234567890EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_DEFAULT_REGION=us-east-1
```

**リージョンについて**：
- `us-east-1`: 米国東部（バージニア）- 最も安定
- `ap-northeast-1`: アジアパシフィック（東京）- 日本から最速
- その他のリージョンも利用可能

## 5. セキュリティのベストプラクティス

### 必須
- **絶対に**認証情報をGitにコミットしない
- `.env`ファイルは`.gitignore`に含める
- 定期的にアクセスキーをローテーション（90日ごと推奨）

### 推奨
- 使用しないアクセスキーは削除
- CloudTrailでAPI使用状況を監視
- 本番環境ではIAMロールを使用

## 6. 動作確認

テストスクリプトを実行：
```bash
python test_polly.py
```

成功すると「✓ Amazon Polly is working correctly!」と表示されます。

## トラブルシューティング

### エラー: "Invalid security token"
- アクセスキーが正しくコピーされているか確認
- リージョンが正しく設定されているか確認

### エラー: "Access Denied"
- IAMユーザーにPolly権限があるか確認
- ポリシーが正しくアタッチされているか確認

### エラー: "Could not connect to the endpoint"
- インターネット接続を確認
- AWS_DEFAULT_REGIONが有効なリージョンか確認

## 料金について

Amazon Pollyの料金（2024年現在）：
- **標準音声**: 100万文字あたり$4.00
- **ニューラル音声**: 100万文字あたり$16.00
- **無料枠**: 毎月500万文字（標準）または100万文字（ニューラル）※初年度のみ

通常の使用では月額料金はほとんどかかりません。