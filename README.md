# Anki AI Vocabulary Tool

A Dockerized command-line tool that automatically adds English vocabulary to your Anki deck with AI-generated definitions, pronunciation, and examples.

## Features

- Fetches word information using OpenAI's GPT model:
  - Japanese meaning
  - English definition with parts of speech [noun], [verb], [adjective], etc.
  - IPA pronunciation
  - Related idioms/phrases
  - Example sentences
  - Similar words with differences
- **Automatic audio generation** using Amazon Polly:
  - Word pronunciation with clear, slower speech
  - Example sentence pronunciation with natural speech
  - Multiple voice options available (Joanna, Matthew, Amy, Brian, Mizuki, Takumi, etc.)
  - Neural engine for high-quality speech
  - Significantly faster response time compared to OpenAI TTS
  - Generated by default (can be disabled with --no-audio)
- **Card management**:
  - Add new vocabulary cards with AI-generated content
  - Delete existing cards by word search
  - Automatic deck creation if needed
- **Interactive mode** for continuous word processing
- Automatically creates formatted Anki cards with audio playback
- Works with AnkiConnect add-on
- Fully containerized with Docker - no local installation needed
- **Type-safe TypeScript implementation** with comprehensive error handling

## Prerequisites

1. **Docker and Docker Compose** installed on your system
   - [Install Docker Desktop](https://www.docker.com/products/docker-desktop/)

2. **Anki Desktop** with **AnkiConnect** add-on installed
   - Install AnkiConnect: Tools → Add-ons → Get Add-ons → Code: `2055492159`
   - Keep Anki running while using this tool

3. **OpenAI API Key**
   - Get your API key from https://platform.openai.com/api-keys

4. **AWS Account with Polly Access**
   - Create AWS access keys with Amazon Polly permissions
   - Guide: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html

## Installation

1. Clone this repository:
   ```bash
   git clone <repository-url>
   cd anki-ai-vocab
   ```

2. Create your `.env` file:
   ```bash
   cp .env.example .env
   ```

3. Edit `.env` and add your API keys:
   ```
   OPENAI_API_KEY=your-actual-api-key-here
   AWS_ACCESS_KEY_ID=your-aws-access-key-id
   AWS_SECRET_ACCESS_KEY=your-aws-secret-access-key
   AWS_DEFAULT_REGION=us-east-1
   ```

4. Build the Docker image:
   ```bash
   docker compose -f docker-compose.ts.yml build
   ```

## Usage

### Basic Usage

Add a word to your Anki deck (audio is generated automatically):
```bash
docker compose -f docker-compose.ts.yml run --rm anki-vocab "serendipity"
```

### Interactive Mode

Enter interactive mode for continuous word processing:
```bash
docker compose -f docker-compose.ts.yml run --rm anki-vocab --interactive
```

Interactive commands:
```
> add sophisticated
> add sophisticated 洗練された,上品な
> delete simple
> help
> quit
```

### Advanced Options

**Without Audio:**
```bash
docker compose -f docker-compose.ts.yml run --rm anki-vocab "serendipity" --no-audio
```

**With Custom Deck:**
```bash
docker compose -f docker-compose.ts.yml run --rm anki-vocab "eloquent" --deck "Advanced English"
```

**With Custom Note Type:**
```bash
docker compose -f docker-compose.ts.yml run --rm anki-vocab "ubiquitous" --model "Basic (and reversed card)"
```

**With Custom Voice:**
Choose from Amazon Polly's available voices:
- English voices: Joanna, Matthew, Amy, Brian, Joey, Justin, etc.
- Japanese voices: Mizuki, Takumi
```bash
docker compose -f docker-compose.ts.yml run --rm anki-vocab "eloquent" --voice "Matthew"
```

**With Specific Japanese Meanings:**
```bash
docker compose -f docker-compose.ts.yml run --rm anki-vocab "run" --japanese-meaning "走る,経営する"
```

**Delete a Word:**
```bash
docker compose -f docker-compose.ts.yml run --rm anki-vocab "serendipity" --delete
```

### Local Development

```bash
# Install dependencies
npm install

# Run in development mode
npm run dev "word"

# Build TypeScript
npm run build

# Run built version
npm start "word"

# Run tests
npm test

# Lint code
npm run lint
```

### Debug Scripts

Test your environment setup:

```bash
# Check environment variables
npm run dev src/debug/debugEnv.ts

# Test AWS Polly integration
npm run dev src/debug/testPolly.ts
```

## Configuration

### Environment Variables

You can configure the tool using environment variables in your `.env` file:

- `OPENAI_API_KEY`: Your OpenAI API key (required)
- `AWS_ACCESS_KEY_ID`: Your AWS access key ID (required)
- `AWS_SECRET_ACCESS_KEY`: Your AWS secret access key (required)
- `AWS_DEFAULT_REGION`: AWS region for Polly (default: `us-east-1`)
- `ANKI_HOST`: Anki host address (default: `host.docker.internal`)
- `ANKI_PORT`: AnkiConnect port (default: `8765`)
- `DECK_NAME`: Default Anki deck name (default: `English Vocabulary`)
- `MODEL_NAME`: Default Anki note model (default: `Basic (and reversed card)`)

### Platform-Specific Settings

**For macOS/Windows:**
The default configuration should work. Docker Desktop provides `host.docker.internal` to access the host machine.

**For Linux:**
Edit `docker-compose.ts.yml` and:
1. Uncomment the `network_mode: "host"` line
2. Comment out the `extra_hosts` section
3. Change `ANKI_HOST` in `.env` to `localhost`

## Example Output

```
$ docker compose -f docker-compose.ts.yml run --rm anki-vocab "ubiquitous"
Fetching information for 'ubiquitous'...

Using note type 'Basic (and reversed card)' with fields: Front, Back

Word information retrieved:
  Japanese:
    1. 遍在する
    2. 至る所にある
  English:
    1. [adjective] present, appearing, or found everywhere
  IPA: /juːˈbɪkwɪtəs/
  Idiom: N/A
  Example:
    1. Smartphones have become ubiquitous in modern society.
  Similar Words:
    1. omnipresent: more formal, often used in religious contexts
       → より正式で、宗教的な文脈でよく使われる
    2. pervasive: suggests spreading throughout something
       → 何かに浸透していることを示唆する

Generating audio with voice 'Matthew'...
✓ Audio files generated successfully (2 files: 1 word + 1 examples)

Adding to Anki...
  Field 'Front' contains audio tags
  Field 'Back' contains audio tags
✓ Successfully added 'ubiquitous' with audio to deck 'English Vocabulary' (Note ID: 1234567890)
```

## Card Format

The tool creates cards with:
- **Front**: Word with audio playback, IPA pronunciation
- **Back**:
  - English definitions with parts of speech
  - Example sentences with audio playback
  - Japanese meanings
  - Idioms/phrases (if any)
  - Similar words with differences

## Troubleshooting

- **"Cannot connect to Anki"**:
  - Make sure Anki is running with AnkiConnect installed
  - For Linux users, ensure you're using the correct network configuration
  - Check that AnkiConnect is accessible at `http://localhost:8765`

- **"OpenAI API key not found"**:
  - Ensure your `.env` file contains the correct API key
  - The `.env` file should be in the same directory as `docker-compose.ts.yml`

- **"Duplicate card"**:
  - The word already exists in your deck
  - The tool prevents duplicates by default

- **Docker build fails**:
  - Make sure you have enough disk space
  - Try rebuilding: `docker compose -f docker-compose.ts.yml build --no-cache`

## Technical Details

- **TypeScript**: Full type safety with comprehensive error handling
- **Async/Await**: Modern JavaScript async patterns throughout
- **Modular Architecture**: Organized into separate modules for maintainability
- **Error Handling**: Structured error types for different failure scenarios
- **Testing**: Jest framework with TypeScript support

## Clean Up

To remove the Docker image:
```bash
docker rmi anki-ai-vocab:latest
```