# Anki AI Vocabulary Tool

A Dockerized command-line tool that automatically adds English vocabulary to your Anki deck with AI-generated definitions, pronunciation, and examples.

> **üöÄ New TypeScript Version Available!** 
> This project is now available in both Python and TypeScript versions. See the [TypeScript Version](#typescript-version) section for details.

## Features

- Fetches word information using OpenAI's GPT model:
  - Japanese meaning
  - English definition with parts of speech [noun], [verb], [adjective], etc.
  - IPA pronunciation
  - Related idioms/phrases
  - Example sentences
- **Automatic audio generation** using Amazon Polly:
  - Word pronunciation with clear, slower speech
  - Example sentence pronunciation with natural speech
  - Multiple voice options available (Joanna, Matthew, Amy, Brian, Mizuki, Takumi, etc.)
  - Neural engine for high-quality speech
  - Significantly faster response time compared to OpenAI TTS
  - Generated by default (can be disabled with --no-audio)
- **Card management**:
  - Add new vocabulary cards with AI-generated content
  - Delete existing cards by word search
  - Automatic deck creation if needed
- Automatically creates formatted Anki cards with audio playback
- Works with AnkiConnect add-on
- Fully containerized with Docker - no local Python installation needed

## Prerequisites

1. **Docker and Docker Compose** installed on your system
   - [Install Docker Desktop](https://www.docker.com/products/docker-desktop/)

2. **Anki Desktop** with **AnkiConnect** add-on installed
   - Install AnkiConnect: Tools ‚Üí Add-ons ‚Üí Get Add-ons ‚Üí Code: `2055492159`
   - Keep Anki running while using this tool

3. **OpenAI API Key**
   - Get your API key from https://platform.openai.com/api-keys

4. **AWS Account with Polly Access**
   - Create AWS access keys with Amazon Polly permissions
   - Guide: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html

## Installation

1. Clone this repository:
   ```bash
   git clone <repository-url>
   cd anki-ai-vocab
   ```

2. Create your `.env` file:
   ```bash
   cp .env.example .env
   ```

3. Edit `.env` and add your API keys:
   ```
   OPENAI_API_KEY=your-actual-api-key-here
   AWS_ACCESS_KEY_ID=your-aws-access-key-id
   AWS_SECRET_ACCESS_KEY=your-aws-secret-access-key
   AWS_DEFAULT_REGION=us-east-1
   ```

4. Build the Docker image:
   ```bash
   docker-compose build
   ```

## Usage

### Basic Usage

Add a word to your Anki deck (audio is generated automatically):
```bash
docker-compose run --rm anki-vocab "serendipity"
```

### Without Audio

Disable automatic audio generation:
```bash
docker-compose run --rm anki-vocab "serendipity" --no-audio
```

### With Custom Deck

```bash
docker-compose run --rm anki-vocab "eloquent" --deck "Advanced English"
```

### With Custom Note Type

```bash
docker-compose run --rm anki-vocab "ubiquitous" --model "Basic (and reversed card)"
```

### With Custom Voice

Choose from Amazon Polly's available voices:
- English voices: Joanna, Matthew, Amy, Brian, Joey, Justin, etc.
- Japanese voices: Mizuki, Takumi
```bash
docker-compose run --rm anki-vocab "eloquent" --voice "Matthew"
```

### Delete a Word

Delete cards containing a specific word from your deck:
```bash
docker-compose run --rm anki-vocab "serendipity" --delete
```

The tool will:
1. Search for all cards containing the word
2. Show you what will be deleted
3. Ask for confirmation before deleting

### Using Docker Directly (without docker-compose)

```bash
docker run --rm -it \
  -e OPENAI_API_KEY="your-api-key" \
  -e ANKI_HOST="host.docker.internal" \
  --add-host=host.docker.internal:host-gateway \
  anki-ai-vocab:latest "vocabulary"
```

## Configuration

### Environment Variables

You can configure the tool using environment variables in your `.env` file:

- `OPENAI_API_KEY`: Your OpenAI API key (required)
- `AWS_ACCESS_KEY_ID`: Your AWS access key ID (required)
- `AWS_SECRET_ACCESS_KEY`: Your AWS secret access key (required)
- `AWS_DEFAULT_REGION`: AWS region for Polly (default: `us-east-1`)
- `ANKI_HOST`: Anki host address (default: `host.docker.internal`)
- `ANKI_PORT`: AnkiConnect port (default: `8765`)
- `DECK_NAME`: Default Anki deck name (default: `English Vocabulary`)
- `MODEL_NAME`: Default Anki note model (default: `Basic`)

### Platform-Specific Settings

**For macOS/Windows:**
The default configuration should work. Docker Desktop provides `host.docker.internal` to access the host machine.

**For Linux:**
Edit `docker-compose.yml` and:
1. Uncomment the `network_mode: "host"` line
2. Comment out the `extra_hosts` section
3. Change `ANKI_HOST` in `.env` to `localhost`

## Example Output

```
$ docker-compose run --rm anki-vocab "ubiquitous"
Fetching information for 'ubiquitous'...

Word information retrieved:
  Japanese: ÈÅçÂú®„Åô„Çã„ÄÅËá≥„ÇãÊâÄ„Å´„ÅÇ„Çã
  English: 
    1. [adjective] Present, appearing, or found everywhere
  IPA: /juÀêÀàb…™kw…™t…ôs/
  Idiom: N/A
  Example: Smartphones have become ubiquitous in modern society.

Generating audio with voice 'Matthew'...
‚úì Audio files generated successfully

Adding to Anki...
‚úì Successfully added 'ubiquitous' with audio to deck 'English Vocabulary' (Note ID: 1234567890)
```

## Troubleshooting

- **"Cannot connect to Anki"**:
  - Make sure Anki is running with AnkiConnect installed
  - For Linux users, ensure you're using the correct network configuration
  - Check that AnkiConnect is accessible at `http://localhost:8765`

- **"OpenAI API key not found"**:
  - Ensure your `.env` file contains the correct API key
  - The `.env` file should be in the same directory as `docker-compose.yml`

- **"Duplicate card"**:
  - The word already exists in your deck
  - The tool prevents duplicates by default

## Card Format

The tool creates cards with:
- **Front**: Word and IPA pronunciation
- **Back**:
  - Word audio playback button (when audio enabled)
  - Japanese meaning
  - English definition
  - Idioms/phrases (if any)
  - Example sentence
  - Example sentence audio playback button (when audio enabled)

## Development

To modify the tool:
1. Edit the Python script (`anki_vocab.py`)
2. Rebuild the Docker image: `docker-compose build`
3. Test your changes

## TypeScript Version

This project is now available in TypeScript with improved type safety and modern JavaScript features!

### TypeScript Features

- **Type Safety**: Full TypeScript type definitions for all APIs and data structures
- **Modern JavaScript**: ES2022 features with async/await throughout
- **Better Error Handling**: Structured error types with detailed error messages
- **Improved Performance**: Optimized async operations and better memory management
- **Enhanced Development Experience**: Better IDE support and autocomplete

### Using the TypeScript Version

The TypeScript version provides the same functionality as the Python version with improved reliability and developer experience.

#### Build and Run TypeScript Version

```bash
# Build the TypeScript version
docker-compose -f docker-compose.ts.yml build

# Run with TypeScript version
docker-compose -f docker-compose.ts.yml run --rm anki-vocab-ts "serendipity"

# Interactive mode
docker-compose -f docker-compose.ts.yml run --rm anki-vocab-ts --interactive
```

#### Development with TypeScript

```bash
# Install dependencies
npm install

# Run in development mode
npm run dev "word"

# Build for production
npm run build

# Run built version
npm start "word"

# Run tests
npm test

# Lint code
npm run lint
```

#### Debug Scripts

Test your environment setup:

```bash
# Check environment variables
npm run dev src/debug/debugEnv.ts

# Test AWS Polly integration
npm run dev src/debug/testPolly.ts
```

### Choosing Between Versions

- **Python Version**: Mature, stable, smaller Docker image
- **TypeScript Version**: Type-safe, modern features, better development experience

Both versions provide identical functionality and can be used interchangeably.

## Clean Up

To remove the Docker images:
```bash
# Remove Python version
docker rmi anki-ai-vocab:latest

# Remove TypeScript version  
docker rmi anki-ai-vocab-ts:latest
```
